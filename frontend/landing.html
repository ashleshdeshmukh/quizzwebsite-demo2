<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Landing â€¢ Quizzed</title>
    <link rel="stylesheet" href="style.css"/>
    <link rel="stylesheet" href="landing.css"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=menu" />
</head>
<body>
    <div class="curved-edge"></div>
    <h1>Quizzed</h1>

    <!-- Keep your team/journey dropdown unchanged -->
    <div id="dropdowndiv">
        <div id="dropdown" class="material-symbols-outlined"> menu </div>
        <div id="dropdownbutton">
            <p>
                <a href="team.html" target="_self" id="linkteam">Our Team</a>
            </p>
            <p>Our Journey</p>
        </div>
    </div>

    <main>
        <div id="central-box" aria-label="Central content box">
            <h2>Available Quizzes</h2>
            <!-- Changed from list to dropdown -->
            <select id="quiz-dropdown">
                <option disabled selected>-- Select a quiz --</option>
            </select>
            <button id="start-quiz-btn">Start Quiz</button>
        </div>
    </main>

    <div id="class">
        <a><p><</p></a>
        <a><p class="on"> 1 </p></a>
        <a><p> 2 </p></a>
        <a><p> 3 </p></a>
        <a><p> 4 </p></a>
        <a><p> 5 </p></a>
        <a><p> > </p></a>
    </div>

    <script>
        // Fetch quizzes and populate dropdown
        async function fetchQuizzes() {
            const token = localStorage.getItem("token");
            if (!token) {
                alert("You must be logged in to see quizzes.");
                window.location.href = "login.html";
                return;
            }

            try {
                const res = await fetch("http://127.0.0.1:5000/quiz/all", {
                    headers: { "Authorization": `Bearer ${token}` }
                });

                if (!res.ok) throw new Error("Failed to fetch quizzes");

                const quizzes = await res.json();
                const dropdown = document.getElementById("quiz-dropdown");

                if (quizzes.length === 0) {
                    const option = document.createElement("option");
                    option.disabled = true;
                    option.textContent = "No quizzes available yet.";
                    dropdown.appendChild(option);
                    return;
                }

                quizzes.forEach(q => {
                    const option = document.createElement("option");
                    option.value = q.id;
                    option.textContent = q.title;
                    dropdown.appendChild(option);
                });

            } catch (err) {
                console.error(err);
                alert("Could not load quizzes. Make sure you are logged in.");
            }
        }

        // Save selected quiz and redirect
        document.getElementById("start-quiz-btn").addEventListener("click", () => {
            const dropdown = document.getElementById("quiz-dropdown");
            const selectedId = dropdown.value;
            const selectedTitle = dropdown.options[dropdown.selectedIndex]?.text;

            if (!selectedId) {
                alert("Please select a quiz first.");
                return;
            }

            localStorage.setItem("selectedQuizId", selectedId);
            localStorage.setItem("selectedQuizTitle", selectedTitle);
            window.location.href = "quiz.html";
        });

        // Run when page loads
        window.addEventListener("DOMContentLoaded", fetchQuizzes);
    </script>
</body>
</html>
